<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raspadinha Persistente</title>
<style>
:root{
  --bg-desktop: url('https://i.imgur.com/7FXx8jt.png'); /* Link direto do fundo desktop */
  --bg-mobile: url('https://i.imgur.com/GvTCnJ7.png');   /* Link direto do fundo mobile */
}
body{
  margin:0;
  min-height:100vh;
  background: var(--bg-desktop) center/cover no-repeat;
  color:#fff;
  font-family:Arial,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:18px;
  transition: background 0.3s ease;
}
@media (max-width:768px){
  body{
    background: var(--bg-mobile) center/cover no-repeat;
  }
}

.wrap{
  width:360px;
  max-width:96%;
  text-align:center;
}
.logo{
  max-width:150px;
  margin-bottom:12px;
}
.card{
  background:rgba(0,0,0,0.6);
  border-radius:12px;
  padding:14px;
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
}
h1{margin:0 0 12px;font-size:18px;}
.scratch-area{
  position:relative;width:100%;height:200px;border-radius:10px;overflow:hidden;background:#0f1724;display:flex;align-items:center;justify-content:center;margin-bottom:10px;
}
canvas#overlay{
  position:absolute;inset:0;width:100%;height:100%;z-index:2;cursor:grab;border-radius:10px;
}
.prize-below{
  text-align:center;
  font-size:20px;
  min-height:32px;
  margin-bottom:8px;
}
.history{
  font-size:14px;
  text-align:left;
  max-height:120px;
  overflow-y:auto;
  background:rgba(255,255,255,0.05);
  padding:6px 8px;
  border-radius:8px;
  margin-bottom:8px;
}
.controls{display:flex;gap:8px;justify-content:center;margin-top:12px;}
button{background:#ff9f1c;border:none;padding:8px 12px;border-radius:10px;color:#08121b;font-weight:700;cursor:pointer;}
button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;}
.gear{position:fixed;right:18px;bottom:18px;width:52px;height:52px;border-radius:50%;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer;z-index:999;}
.modal-back{position:fixed;inset:0;background:rgba(2,6,12,0.6);display:none;align-items:center;justify-content:center;z-index:1000;}
.modal{width:520px;max-width:94%;background:#041427;padding:16px;border-radius:10px;}
.row{display:flex;gap:8px;margin-top:8px;align-items:center;}
.row input[type="text"], .row input[type="number"], .row input[type="password"]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;}
.small{font-size:13px;color:rgba(170,170,180,0.9);margin-top:6px;}
.danger{background:#ff4d4d;color:#111;}
</style>
</head>
<body>

<div class="wrap">
  <img class="logo" src="https://i.imgur.com/JK12HA7.png" alt="Logo">
  <div class="card">
    <h1>Raspadinha Persistente</h1>

    <div class="scratch-area" id="scratchArea">
      <canvas id="overlay"></canvas>
      <div id="raspeText" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-weight:bold;font-size:20px;pointer-events:none;z-index:3;">Raspe aqui</div>
    </div>

    <div class="prize-below" id="prizeBelow"></div>
    <div class="history" id="history">Hist√≥rico:</div>

    <div class="controls">
      <button id="newBtn">Nova Raspadinha</button>
    </div>
    <div class="small" id="statusText">Limite padr√£o: 7 dias</div>
  </div>
</div>

<div class="gear" id="gearBtn" title="Admin">‚öôÔ∏è</div>

<div class="modal-back" id="modalBack">
  <div class="modal" role="dialog" aria-modal="true">
    <h2>Painel Admin</h2>
    <div id="loginArea">
      <div class="row">
        <input type="password" id="adminPass" placeholder="Senha admin">
        <button id="adminLoginBtn">Entrar</button>
        <button class="ghost" id="modalCloseBtn">Fechar</button>
      </div>
      <div class="small">Senha padr√£o: <b>admin123</b></div>
    </div>

    <div id="panelArea" style="display:none">
      <div class="small">Liberar raspadinhas:</div>
      <div class="row">
        <input type="number" id="grantUsesInput" placeholder="N√∫mero de raspadas" min="1" value="1">
        <button id="grantUsesBtn">Liberar</button>
      </div>
      <div class="small" style="margin-top:10px">Alterar limite em dias:</div>
      <div class="row">
        <input type="number" id="limitDaysInput" min="0" value="7">
        <button id="setLimitBtn">Aplicar limite</button>
      </div>
      <div class="small" style="margin-top:10px">A√ß√µes r√°pidas:</div>
      <div class="row">
        <button id="resetUserBtn" class="ghost">Resetar usu√°rio</button>
        <button id="wipeAllBtn" class="danger">Limpar storage</button>
      </div>
    </div>
  </div>
</div>

<script>
// --- Vari√°veis ---
const overlay=document.getElementById('overlay');
const prizeBelow=document.getElementById('prizeBelow');
const newBtn=document.getElementById('newBtn');
const statusText=document.getElementById('statusText');
const historyDiv=document.getElementById('history');
const raspeText=document.getElementById('raspeText');

const KEY_LAST='raspadinha_last';
const KEY_PRIZE='raspadinha_prize';
const KEY_USES='raspadinha_uses';
const KEY_LIMIT='raspadinha_limit_days';
const KEY_HISTORY='raspadinha_history';
const DEFAULT_LIMIT=7;
const DEFAULT_ADMIN_PASS='admin123';

const PRIZES=[
{emoji:'üéÅ',label:'10% de desconto'},
{emoji:'üéâ',label:'Brinde surpresa'},
{emoji:'üíé',label:'Cupom VIP'},
{emoji:'üß∏',label:'Pel√∫cia exclusiva'},
{emoji:'üç´',label:'Chocolate gr√°tis'},
{emoji:'‚òï',label:'Caf√© gr√°tis'},
{emoji:'üéüÔ∏è',label:'Sorteio VIP'},
{emoji:'‚ú®',label:'Pr√™mio especial'},
{emoji:'üí∞',label:'R$5 cashback'},
{emoji:'üèÜ',label:'Trof√©u digital'}
];

let ctx,w,h,isDrawing=false,revealed=false;

// --- Fun√ß√µes ---
function resizeCanvas(){
  w=overlay.clientWidth;
  h=overlay.clientHeight;
  overlay.width=w;
  overlay.height=h;
  ctx=overlay.getContext('2d');
  createOverlay();
}

function createOverlay(){
  ctx.globalCompositeOperation='source-over';
  ctx.fillStyle='#cfcfcf';
  ctx.fillRect(0,0,w,h);
  ctx.globalAlpha=0.05;
  ctx.fillStyle='#fff';
  for(let i=0;i<60;i++) ctx.fillRect(Math.random()*w,Math.random()*h,Math.random()*80+40,1);
  ctx.globalAlpha=1;
  ctx.globalCompositeOperation='destination-out';
  raspeText.style.display='block';
  prizeBelow.textContent='';
  revealed=false;
}

function pt(e){
  const r=overlay.getBoundingClientRect();
  const p=e.touches?e.touches[0]:e;
  return {x:p.clientX-r.left, y:p.clientY-r.top};
}

function drawDot(x,y){
  ctx.beginPath();
  ctx.arc(x,y,20,0,Math.PI*2);
  ctx.fill();
}

function startDraw(e){
  if(!canScratch()){showLocked(); return;}
  isDrawing=true;
  drawDot(pt(e).x, pt(e).y);
  e.preventDefault();
}
function moveDraw(e){
  if(!isDrawing) return;
  e.preventDefault();
  const p=pt(e);
  ctx.lineWidth=20;
  ctx.lineCap='round';
  ctx.beginPath();
  ctx.moveTo(p.x,p.y);
  ctx.lineTo(p.x+0.01,p.y+0.01);
  ctx.stroke();
  checkReveal();
}
function endDraw(){if(!isDrawing) return; isDrawing=false; checkReveal();}

function pickPrize(){return PRIZES[Math.floor(Math.random()*PRIZES.length)];}

function checkReveal(){
  const img=ctx.getImageData(0,0,w,h).data;
  let cleared=0;
  for(let i=3;i<img.length;i+=4) if(img[i]===0) cleared++;
  if(cleared/(w*h)*100>35 && !revealed){
    revealed=true;
    let prize=getStoredPrize();
    if(!prize) prize=pickPrize();
    prizeBelow.textContent=prize.emoji+' '+prize.label;
    setStoredPrize(prize);
    addHistory(prize);
    setUses(getUses()-1);
    setLast(Date.now());
    overlay.style.pointerEvents='none';
    raspeText.style.display='none';
    newBtn.style.display='none';
  }
}

// --- Storage ---
function getLast(){return parseInt(localStorage.getItem(KEY_LAST)||'0',10);}
function setLast(v){localStorage.setItem(KEY_LAST,String(v));}
function getUses(){return parseInt(localStorage.getItem(KEY_USES)||'1',10);}
function setUses(v){localStorage.setItem(KEY_USES,String(v));}
function getLimit(){return parseInt(localStorage.getItem(KEY_LIMIT)||DEFAULT_LIMIT,10);}
function setLimit(v){localStorage.setItem(KEY_LIMIT,String(v)); statusText.textContent='Limite: '+v+' dia(s)';}
function getStoredPrize(){try{return JSON.parse(localStorage.getItem(KEY_PRIZE));}catch(e){return null;}}
function setStoredPrize(p){localStorage.setItem(KEY_PRIZE,JSON.stringify(p));}
function getHistory(){try{return JSON.parse(localStorage.getItem(KEY_HISTORY))||[];}catch(e){return []}}
function addHistory(p){
  const h=getHistory();
  h.unshift({time:Date.now(),emoji:p.emoji,label:p.label});
  localStorage.setItem(KEY_HISTORY,JSON.stringify(h));
  updateHistory();
}
function updateHistory(){
  const h=getHistory();
  historyDiv.innerHTML=h.map(i=>`${new Date(i.time).toLocaleString()}: ${i.emoji} ${i.label}`).join('<br>')||'Hist√≥rico:';
}

function canScratch(){
  const last=getLast();
  const limit=getLimit()*24*60*60*1000;
  return getUses()>0 || (Date.now()-last)>limit;
}

function showLocked(){
  const prize=getStoredPrize();
  prizeBelow.textContent=prize?prize.emoji+' '+prize.label:'Voc√™ j√° usou!';
  overlay.style.pointerEvents='none';
  newBtn.style.display='none';
  raspeText.style.display='none';
  const last=getLast();
  const remaining=Math.max(0,getLimit()*24*60*60*1000-(Date.now()-last));
  const hours=Math.floor(remaining/3600000);
  const minutes=Math.floor((remaining%3600000)/60000);
  const seconds=Math.floor((remaining%60000)/1000);
  statusText.textContent=`Pr√≥xima raspadinha em ${hours}h ${minutes}m ${seconds}s`;
}

// --- Eventos ---
window.addEventListener('load',()=>{
  resizeCanvas();
  updateHistory();
  if(!canScratch()) showLocked();
});
window.addEventListener('resize',()=>setTimeout(resizeCanvas,50));

overlay.addEventListener('pointerdown',e=>{overlay.setPointerCapture(e.pointerId); startDraw(e);});
overlay.addEventListener('pointermove',moveDraw);
overlay.addEventListener('pointerup',endDraw);
overlay.addEventListener('pointercancel',endDraw);
overlay.addEventListener('touchstart',startDraw,{passive:false});
overlay.addEventListener('touchmove',moveDraw,{passive:false});
overlay.addEventListener('touchend',endDraw);

newBtn.addEventListener('click',()=>{createOverlay(); overlay.style.pointerEvents='auto'; newBtn.style.display='inline-block';});

// Admin (permanece igual)
const gearBtn=document.getElementById('gearBtn');
const modalBack=document.getElementById('modalBack');
const modalCloseBtn=document.getElementById('modalCloseBtn');
const adminPassInput=document.getElementById('adminPass');
const adminLoginBtn=document.getElementById('adminLoginBtn');
const loginArea=document.getElementById('loginArea');
const panelArea=document.getElementById('panelArea');
const grantUsesInput=document.getElementById('grantUsesInput');
const grantUsesBtn=document.getElementById('grantUsesBtn');
const limitDaysInput=document.getElementById('limitDaysInput');
const setLimitBtn=document.getElementById('setLimitBtn');
const resetUserBtn=document.getElementById('resetUserBtn');
const wipeAllBtn=document.getElementById('wipeAllBtn');

gearBtn.addEventListener('click',()=>{modalBack.style.display='flex';adminPassInput.focus();});
modalCloseBtn.addEventListener('click',()=>{modalBack.style.display='none';adminPassInput.value='';});
modalBack.addEventListener('click',e=>{if(e.target===modalBack){modalBack.style.display='none';adminPassInput.value='';}});
adminLoginBtn.addEventListener('click',()=>{if(adminPassInput.value===DEFAULT_ADMIN_PASS){loginArea.style.display='none';panelArea.style.display='block';}else{alert('Senha incorreta');}});
grantUsesBtn.addEventListener('click',()=>{let n=parseInt(grantUsesInput.value)||1; setUses(n); alert('Usu√°rio liberado para '+n+' raspada(s).');});
setLimitBtn.addEventListener('click',()=>{let d=parseInt(limitDaysInput.value)||DEFAULT_LIMIT; setLimit(d); alert('Limite alterado para '+d+' dia(s)');});
resetUserBtn.addEventListener('click',()=>{if(confirm('Resetar usu√°rio?')){localStorage.removeItem(KEY_LAST);localStorage.removeItem(KEY_PRIZE);localStorage.removeItem(KEY_USES);localStorage.removeItem(KEY_HISTORY);createOverlay(); overlay.style.pointerEvents='auto'; newBtn.style.display='inline-block'; updateHistory();}});
wipeAllBtn.addEventListener('click',()=>{if(confirm('Limpar storage da p√°gina?')){localStorage.clear();alert('Storage limpo. Recarregue a p√°gina.'); updateHistory();}});
</script>
</body>
</html>
